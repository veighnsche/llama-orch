# TEAM-286: rbee-sdk (Rust + WASM) - Implementation Plan Overview

**Date:** Oct 24, 2025  
**Status:** ğŸ“‹ **PLANNING**  
**Team:** TEAM-286  
**Approach:** Rust â†’ WASM â†’ JavaScript/TypeScript

---

## Mission

Build a **Rust-based SDK** that compiles to WASM for browser/Node.js usage, **reusing all existing shared crates** from the rbee monorepo.

---

## Key Insight: THIN WRAPPER, NOT REWRITE

We already have:
- âœ… `job-client` - Complete job submission + SSE streaming
- âœ… `operations-contract` - All operation types
- âœ… `rbee-config` - Configuration handling
- âœ… All error types and utilities

**We just need to:**
1. Add `wasm-bindgen` bindings to expose these to JavaScript
2. Handle JS â†” Rust conversion
3. Compile to WASM with `wasm-pack`

---

## Plan Structure

This implementation is divided into **4 phases** (much simpler than TypeScript!):

1. **[Phase 1: WASM Setup](./TEAM_286_PHASE_1_WASM_SETUP.md)** (1 day)
   - Add wasm-bindgen dependencies
   - Configure wasm-pack
   - Basic project setup

2. **[Phase 2: Core Bindings](./TEAM_286_PHASE_2_CORE_BINDINGS.md)** (2 days)
   - Wrap job-client for WASM
   - Expose operations-contract types
   - Basic RbeeClient class

3. **[Phase 3: All Operations](./TEAM_286_PHASE_3_ALL_OPERATIONS.md)** (1-2 days)
   - Expose all operations
   - JavaScript-friendly API
   - Examples

4. **[Phase 4: Publishing](./TEAM_286_PHASE_4_PUBLISHING.md)** (1 day)
   - Build with wasm-pack
   - Publish to npm
   - Documentation

**Total Timeline: 5-6 days** (vs 10-15 for TypeScript!)

---

## Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Existing Shared Crates (REUSE!)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â€¢ job-client              - HTTP + SSE streaming        â”‚
â”‚  â€¢ operations-contract     - All operation types         â”‚
â”‚  â€¢ rbee-config            - Configuration                â”‚
â”‚  â€¢ observability-*        - Error handling               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  rbee-sdk (THIS CRATE)                                   â”‚
â”‚  â€¢ src/lib.rs            - wasm-bindgen wrappers         â”‚
â”‚  â€¢ src/client.rs         - RbeeClient wrapper            â”‚
â”‚  â€¢ src/types.rs          - Type conversions              â”‚
â”‚  â€¢ Cargo.toml            - WASM dependencies             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“ wasm-pack build
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  pkg/ (Generated by wasm-pack)                           â”‚
â”‚  â€¢ rbee_sdk.wasm         - Compiled WASM binary          â”‚
â”‚  â€¢ rbee_sdk.js           - JavaScript glue code          â”‚
â”‚  â€¢ rbee_sdk.d.ts         - TypeScript types (auto!)      â”‚
â”‚  â€¢ package.json          - Ready to publish              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  JavaScript/TypeScript Usage                             â”‚
â”‚  import { RbeeClient } from '@rbee/sdk';                 â”‚
â”‚  const client = new RbeeClient('http://localhost:8500'); â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Benefits of Rust + WASM

### âœ… Code Reuse (CRITICAL!)
- **job-client**: Already has `submit_and_stream()` - just expose it!
- **operations-contract**: All types already defined - zero manual work!
- **No duplication**: Same code as rbee-keeper and queen-rbee
- **Shared bug fixes**: Fix in job-client, SDK gets it automatically

### âœ… Type Safety
- **Auto-generated TypeScript types** via wasm-bindgen
- **Impossible to drift**: Same Rust code as backend
- **Compile-time guarantees**: Rust compiler ensures correctness

### âœ… Performance
- **Fast**: WASM runs at near-native speed
- **Small bundle**: ~100-200KB gzipped
- **Efficient**: No JSON parsing overhead in hot paths

### âœ… Maintenance
- **Single codebase**: One implementation for all platforms
- **Fix once**: Bug fixes propagate everywhere
- **Shared tests**: Test Rust code, get JS/TS for free

---

## Comparison: TypeScript vs Rust+WASM

| Aspect | TypeScript | Rust + WASM |
|--------|-----------|-------------|
| **Development Time** | 10-15 days | 5-6 days âœ… |
| **Code Reuse** | 0% (rewrite) | 90%+ âœ… |
| **Type Sync** | Manual | Automatic âœ… |
| **Performance** | Good | Excellent âœ… |
| **Bundle Size** | ~50KB | ~150KB |
| **Maintenance** | Duplicate code | Shared code âœ… |
| **Dependencies** | 0 runtime | 0 runtime âœ… |

**Rust + WASM wins in every category that matters!**

---

## What We're Actually Building

### Thin Wrappers Around Existing Code

**NOT THIS (TypeScript approach):**
```typescript
// 500+ lines of reimplementation
async submitAndStream(operation, onLine) {
  // Reimplement HTTP logic
  // Reimplement SSE parsing
  // Reimplement error handling
  // ...
}
```

**THIS (Rust + WASM approach):**
```rust
// TEAM-286: ~20 lines - just expose existing code!
#[wasm_bindgen]
pub async fn submit_and_stream(
    &self,
    operation: JsValue,
    callback: js_sys::Function,
) -> Result<String, JsValue> {
    let op: Operation = serde_wasm_bindgen::from_value(operation)?;
    
    // REUSE job-client! Already works!
    self.client.submit_and_stream(op, |line| {
        callback.call1(&JsValue::null(), &JsValue::from_str(line))?;
        Ok(())
    }).await.map_err(|e| JsValue::from_str(&e.to_string()))
}
```

---

## Dependencies

### Existing Crates (Already Have!)
```toml
job-client = { path = "../../bin/99_shared_crates/job-client" }
operations-contract = { path = "../../bin/97_contracts/operations-contract" }
rbee-config = { path = "../../bin/99_shared_crates/rbee-config" }
```

### New WASM Dependencies (Only!)
```toml
wasm-bindgen = "0.2"
wasm-bindgen-futures = "0.4"
serde-wasm-bindgen = "0.6"
js-sys = "0.3"
web-sys = { version = "0.3", features = ["Window", "Headers", "Request", "Response"] }
```

**That's it!** No reimplementing anything.

---

## Success Criteria

### MVP (v0.1.0) - 5-6 days

- âœ… WASM compiles successfully
- âœ… job-client exposed to JavaScript
- âœ… All operations work
- âœ… TypeScript types auto-generated
- âœ… Published to npm
- âœ… Examples work in browser and Node.js

### Full (v1.0.0)

- âœ… All MVP criteria
- âœ… React hooks wrapper (pure JS, separate package)
- âœ… Comprehensive docs
- âœ… Example applications

---

## Tooling

### Build Tools
- **wasm-pack** - Build and package WASM
- **cargo** - Rust compiler
- **npm/pnpm** - Package management

### No Other Tools Needed!
- âŒ No esbuild (wasm-pack handles bundling)
- âŒ No TypeScript compiler (types auto-generated)
- âŒ No manual type generation (wasm-bindgen does it)

---

## Timeline

| Phase | Duration | What We Do |
|-------|----------|------------|
| Phase 1: WASM Setup | 1 day | Add dependencies, configure wasm-pack |
| Phase 2: Core Bindings | 2 days | Wrap job-client, expose to JS |
| Phase 3: All Operations | 1-2 days | Expose existing operations |
| Phase 4: Publishing | 1 day | Build, test, publish |
| **Total** | **5-6 days** | **vs 10-15 for TypeScript!** |

---

## Next Steps

1. **Review Phase 1** - WASM setup and dependencies
2. **Start implementation** - Add wasm-bindgen to Cargo.toml
3. **Wrap job-client** - Expose to JavaScript
4. **Compile and test** - wasm-pack build
5. **Publish** - npm publish

---

## Why This Approach Was Missed

Looking at the original handoff:
- âœ… `src/lib.rs` already exists - clearly Rust!
- âœ… `Cargo.toml` already exists - clearly Rust!
- âœ… Mission says "modernize" - not "rewrite in TypeScript"

**Lesson learned:** Always check existing project structure before planning!

---

## Engineering Rules Compliance

âœ… **Consult existing code:** Use job-client, operations-contract  
âœ… **No duplication:** Reuse shared crates  
âœ… **Code signatures:** Add TEAM-286 to new code  
âœ… **Complete handoffs:** 2 pages max with code examples  

---

**Ready to build the RIGHT way!** ğŸš€

---

**Created by:** TEAM-286  
**Date:** Oct 24, 2025  
**Approach:** Rust + WASM (CORRECTED)  
**Estimated Duration:** 5-6 days
