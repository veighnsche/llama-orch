# Build Warnings Catalog

**Generated:** 2025-11-01  
**Build:** `cargo build --bin rbee-hive`

## Summary

- **Total Warning Categories:** 13
- **Total Warnings:** ~120+
- **Critical Issues:** 1 (rebuild bug - FIXED by TEAM-373)
- **Action Required:** Cleanup unused imports, add missing docs

---

## 1. Cargo.toml Configuration Warnings (4)

### 1.1 Profile Warning
```
warning: profiles for the non root package will be ignored
package:   /home/vince/Projects/llama-orch/bin/30_llm_worker_rbee/Cargo.toml
workspace: /home/vince/Projects/llama-orch/Cargo.toml
```

**Impact:** Low - profiles in non-root packages are ignored  
**Fix:** Remove `[profile.*]` sections from child crates

### 1.2 Unused Manifest Keys (3 instances)
```
warning: unused manifest key: package.autodocs
- bin/98_security_crates/jwt-guardian/Cargo.toml
- bin/98_security_crates/auth-min/Cargo.toml
- xtask/Cargo.toml
```

**Impact:** Low - unknown key ignored  
**Fix:** Remove `autodocs` key or check if it's a custom tool

---

## 2. observability-narration-core Deprecations (69 warnings)

All related to migration from old builder pattern to new `n!()` macro.

### Deprecated Items
- `human()` function
- `Narration` struct
- `NarrationFactory` struct
- All builder methods and fields

### Status
These are **intentional deprecations** during API migration. Old code still works but should migrate to `n!()` macro.

### Example Migration
```rust
// OLD (deprecated)
NARRATE.action("build_start").human("Building...").emit();

// NEW (preferred)
n!("build_start", "Building...");
```

**Impact:** Low - deprecation warnings, code still works  
**Action:** Migrate remaining code to `n!()` macro over time

**ðŸ“‹ See:** [NARRATE_DEPRECATION_CATALOG.md](./NARRATE_DEPRECATION_CATALOG.md) for complete migration plan

---

## 3. rbee-hive-monitor Unused Imports (6)

**File:** `bin/25_rbee_hive_crates/monitor/src/lib.rs`

```rust
use anyhow::{Context, Result};      // Line 19
use std::path::PathBuf;              // Line 21
use std::process::Stdio;             // Line 22
use std::fs;                         // Line 26
use std::io::Write;                  // Line 28
```

**File:** `bin/25_rbee_hive_crates/monitor/src/monitor.rs`

```rust
use std::time::Duration;             // Line 403 (in tests)
```

**Impact:** Low - unused imports  
**Fix:** Run `cargo fix --lib -p rbee-hive-monitor`

---

## 4. observability-narration-macros (2)

**File:** `bin/99_shared_crates/narration-macros/src/with_job_id.rs`

```rust
use syn::{parse_macro_input, parse_quote, ItemFn, Meta};  // Line 36
//                           ^^^^^^^^^^^
// Unused import

let mut input_fn = parse_macro_input!(item as ItemFn);    // Line 39
//  ^^^ Unnecessary mut
```

**Impact:** Low  
**Fix:** Remove `parse_quote` import, remove `mut` from `input_fn`

---

## 5. lifecycle-shared (1)

**Issue:** Missing documentation for functions generated by `#[with_job_id]` macro

```rust
#[with_job_id(config_param = "build_config")]
pub async fn build_daemon(...) -> Result<PathBuf> {
    // ^^^ Missing doc comment
}
```

**Impact:** Low - documentation lint  
**Fix:** Add doc comments above `#[with_job_id]` attribute

---

## 6. heartbeat-registry (1)

**Issue:** Missing `Debug` implementation

```rust
pub struct HeartbeatRegistry<T: HeartbeatItem> {
    items: RwLock<HashMap<String, T>>,
}
// Missing: #[derive(Debug)]
```

**Impact:** Low - missing Debug trait  
**Fix:** Add `#[derive(Debug)]` or manual Debug impl

---

## 7. lifecycle-local Unused Imports (7)

**Pattern:** `timeout_enforcer::with_timeout` imported but not used

**Files:**
- `bin/96_lifecycle/lifecycle-local/src/install.rs:66`
- `bin/96_lifecycle/lifecycle-local/src/rebuild.rs:67`
- `bin/96_lifecycle/lifecycle-local/src/shutdown.rs:60`
- `bin/96_lifecycle/lifecycle-local/src/start.rs:62` (also `std::path::PathBuf`)
- `bin/96_lifecycle/lifecycle-local/src/start.rs:63`
- `bin/96_lifecycle/lifecycle-local/src/stop.rs:50`
- `bin/96_lifecycle/lifecycle-local/src/uninstall.rs:54`

**Reason:** Functions now use `#[with_timeout]` attribute macro instead of manual `with_timeout()` calls

**Impact:** Low  
**Fix:** Run `cargo fix --lib -p lifecycle-local`

---

## 8. lifecycle-local Missing Docs (6)

**Issue:** Functions generated by `#[with_job_id]` macro lack documentation

**Files:**
- `install.rs:108`
- `rebuild.rs:135`
- `shutdown.rs:101`
- `start.rs:108`
- `stop.rs:88`
- `uninstall.rs:121`

**Impact:** Low - documentation lint  
**Fix:** Add doc comments above `#[with_job_id]` attribute

---

## 9. rbee-hive-device-detection (1)

**Issue:** Dead code

```rust
fn detect_metal_devices() -> Option<u32> {
    // ^^^ Never used
}
```

**Impact:** Low - unused function  
**Fix:** Remove function or add `#[allow(dead_code)]` if needed for future

---

## 10. rbee-hive-model-provisioner (3)

### 10.1 Unused Variable
```rust
async fn download(&self, id: &str, dest: &Path, job_id: &str) -> Result<u64> {
    //                                           ^^^^^^
    // Not used in function body
}
```

**Fix:** Prefix with underscore: `_job_id: &str`

### 10.2 Missing Debug (2 instances)
```rust
pub struct HuggingFaceVendor { ... }  // Missing Debug
pub struct ModelProvisioner { ... }   // Missing Debug
```

**Fix:** Add `#[derive(Debug)]`

---

## 11. hive-contract (5)

**Issue:** Missing documentation for struct fields

```rust
pub struct HiveDevice {
    pub id: String,              // Missing doc
    pub name: String,            // Missing doc
    pub device_type: String,     // Missing doc
    pub vram_gb: Option<u32>,    // Missing doc
    pub compute_capability: Option<String>,  // Missing doc
}
```

**Impact:** Low - documentation lint  
**Fix:** Add `/// Documentation` above each field

---

## 12. rbee-hive lib (4)

**File:** `bin/20_rbee_hive/src/heartbeat.rs`

```rust
use hive_contract::{HiveHeartbeat, HiveInfo};  // Line 11
//                  ^^^^^^^^^^^^^
// Unused import

use std::sync::atomic::{AtomicBool, AtomicUsize, Ordering};  // Line 13
//                                  ^^^^^^^^^^^
// Unused import

use rbee_hive_monitor;  // Line 17
// Unused import

fn detect_capabilities() -> Vec<HiveDevice> {  // Line 22
    // ^^^ Never used
}
```

**Impact:** Low  
**Fix:** Remove unused imports and dead function

---

## 13. rbee-hive bin (5)

### 13.1 Unused Import
```rust
pub use heartbeat_stream::{handle_heartbeat_stream, HeartbeatStreamState};
//                                                  ^^^^^^^^^^^^^^^^^^^^
// Unused in bin
```

### 13.2 Unused Variables (3)
```rust
let worker_binary = state...;  // Line 172 - never used
let hive_id = request.hive_id.clone();  // Line 432 - never used
let hive_id = request.hive_id.clone();  // Line 446 - never used
```

### 13.3 Dead Field
```rust
pub struct HeartbeatStreamState {
    pub hive_info: HiveInfo,  // Never read
}
```

**Impact:** Low  
**Fix:** Remove unused items or prefix with underscore

---

## Action Plan

### High Priority (Breaking Functionality)
- âœ… **FIXED by TEAM-373:** Rebuild not copying binary to remote

### Medium Priority (Code Quality)
1. Clean up unused imports in lifecycle crates (run `cargo fix`)
2. Add missing documentation for `#[with_job_id]` functions
3. Remove dead code in device-detection and heartbeat modules

### Low Priority (Lints)
1. Add `#[derive(Debug)]` to missing structs
2. Migrate remaining code from old narration API to `n!()` macro
3. Fix Cargo.toml warnings (remove unused keys)

### Deferred
- Narration deprecation warnings (69) - intentional during migration

---

## Quick Fixes

```bash
# Fix unused imports automatically
cargo fix --lib -p lifecycle-local
cargo fix --lib -p lifecycle-ssh
cargo fix --lib -p rbee-hive-monitor

# Check remaining warnings
cargo check --bin rbee-hive 2>&1 | grep "warning:" | wc -l
```

---

**TEAM-373: Cataloged all build warnings and fixed critical rebuild bug**
