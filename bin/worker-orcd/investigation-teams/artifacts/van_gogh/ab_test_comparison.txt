TEAM VAN GOGH - A/B Test Results
================================================================================

Test Date: 2025-10-07T22:43Z
Model: qwen2.5-0.5b-instruct-fp16.gguf
Test: haiku_generation_anti_cheat

================================================================================
PATH A: RAW WEIGHTS (mean=7.14, max=16.75)
================================================================================

Hidden State Range (post-RMSNorm): [-40.343750, 97.687500]
  - Span: 138.03
  - Max absolute: 97.69

Logit Range: [-13.312121, 12.462059]
  - Span: 25.77
  - Max absolute: 13.31

Peer Review Results:
  - Range in [-20, 30]: ❌ FAIL (hidden state exceeds bounds)
  - No NaN values: ✅ PASS
  - No Inf values: ✅ PASS
  - Overall: ⚠️ SOME TESTS FAILED

Quality Check:
  - ❌ FAIL: Minute word 'forty-four' not found in output
  - Test Status: PASSED (but quality check failed)

================================================================================
PATH B: NORMALIZED WEIGHTS (mean=1.0, scale factor=0.140)
================================================================================

Normalization Applied:
  - Original mean: 7.139321
  - Scale factor: 0.140085 (1.0 / 7.139321)
  - New mean: 1.000000

Hidden State Range (post-RMSNorm): [-5.652344, 13.679688]
  - Span: 19.33
  - Max absolute: 13.68
  - IMPROVEMENT: 7.1× smaller range!

Logit Range: [-1.864295, 1.745650]
  - Span: 3.61
  - Max absolute: 1.86
  - IMPROVEMENT: 7.1× smaller range!

Peer Review Results:
  - Range in [-20, 30]: ✅ PASS (within bounds!)
  - No NaN values: ✅ PASS
  - No Inf values: ✅ PASS
  - Overall: ⚠️ SOME TESTS FAILED (but range check passed!)

Quality Check:
  - ❌ FAIL: Minute word 'forty-five' not found in output
  - Test Status: PASSED (but quality check failed)

================================================================================
COMPARISON SUMMARY
================================================================================

Hidden State Range:
  - RAW:        [-40.34, 97.69]  (span: 138.03)
  - NORMALIZED: [-5.65, 13.68]   (span: 19.33)
  - Ratio: 7.14× reduction (matches weight mean!)

Logit Range:
  - RAW:        [-13.31, 12.46]  (span: 25.77)
  - NORMALIZED: [-1.86, 1.75]    (span: 3.61)
  - Ratio: 7.14× reduction (matches weight mean!)

Peer Review Range Check:
  - RAW:        ❌ FAIL (exceeds [-20, 30])
  - NORMALIZED: ✅ PASS (within [-20, 30])

Output Quality:
  - RAW:        ❌ Missing 'forty-four'
  - NORMALIZED: ❌ Missing 'forty-five'
  - BOTH FAIL quality check (different words missing)

Test Pass/Fail:
  - RAW:        ✅ Test PASSED (despite quality check failure)
  - NORMALIZED: ✅ Test PASSED (despite quality check failure)

================================================================================
ANALYSIS
================================================================================

1. NORMALIZATION EFFECT IS EXACTLY AS EXPECTED
   - Dividing weights by mean (7.14) reduces output by 7.14×
   - Hidden states: 97.69 → 13.68 (7.14× reduction) ✅
   - Logits: 13.31 → 1.86 (7.15× reduction) ✅

2. NORMALIZED WEIGHTS PASS RANGE CHECK
   - RAW weights produce hidden states up to 97.69 (exceeds [-20, 30])
   - NORMALIZED weights produce hidden states up to 13.68 (within bounds)
   - This suggests NORMALIZED might be more stable

3. BOTH PATHS FAIL QUALITY CHECK
   - Neither produces the exact expected haiku
   - RAW missing 'forty-four', NORMALIZED missing 'forty-five'
   - This suggests the bug is NOT in output_norm weights!

4. BOTH TESTS PASS OVERALL
   - Despite quality failures, both configurations pass the test
   - This means the test is lenient or the quality check is optional

================================================================================
VERDICT
================================================================================

The A/B test shows that:

1. ✅ NORMALIZATION WORKS AS EXPECTED
   - Reduces hidden states and logits by exactly 7.14×
   - Brings values into "normal" range ([-20, 30])

2. ❌ NORMALIZATION DOESN'T FIX OUTPUT QUALITY
   - Both RAW and NORMALIZED fail to produce exact haiku
   - Different words missing suggests different sampling behavior
   - Bug is likely elsewhere (not in output_norm weights)

3. ⚠️ UNCLEAR WHICH IS "CORRECT"
   - RAW: Matches GGUF file, matches llama.cpp (per Round 1)
   - NORMALIZED: Passes range checks, more "typical" values
   - Need llama.cpp comparison to determine ground truth

RECOMMENDATION:
- Do NOT change weights yet
- Need to compare with llama.cpp's actual hidden states/logits
- If llama.cpp has similar large ranges, RAW is correct
- If llama.cpp has small ranges, NORMALIZED might be correct

================================================================================
