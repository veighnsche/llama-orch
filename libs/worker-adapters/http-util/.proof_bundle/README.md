# Proof Bundle — http-util

**Test artifacts and audit trail for http-util**

This directory contains test artifacts generated by `worker-adapters-http-util` tests.

---

## What This Directory Contains

Proof bundle artifacts for verifying http-util behavior:

- **metadata.json** — Build and environment metadata
- **ci_manifest.json** — CI job identifiers and links
- **retry_timeline.jsonl** — Retry schedule events with seed disclosure (NDJSON)
- **streaming_transcript.ndjson** — Streaming transcript events (started/token/metrics/end)
- **redacted_errors.log** — Sample redacted error logs to verify secret scrubbing
- **test_report.md** — Human-readable test summary and pointers to artifacts
- **seeds.txt** — RNG seeds used in tests (determinism disclosure)

---

## Purpose

These artifacts provide:

1. **Traceability** — Link test results to specific builds and commits
2. **Determinism** — Record RNG seeds for reproducible tests
3. **Security verification** — Prove secrets are redacted in logs
4. **Audit trail** — Document retry behavior and timing

---

## Artifact Formats

### metadata.json

```json
{
  "crate": "worker-adapters-http-util",
  "version": "0.0.0",
  "git_commit": "abc123",
  "build_timestamp": "2025-10-01T00:00:00Z",
  "rust_version": "1.75.0"
}
```

### retry_timeline.jsonl

```jsonl
{"attempt":1,"delay_ms":100,"seed":42,"timestamp":"2025-10-01T00:00:00Z"}
{"attempt":2,"delay_ms":210,"seed":42,"timestamp":"2025-10-01T00:00:00.310Z"}
{"attempt":3,"delay_ms":435,"seed":42,"timestamp":"2025-10-01T00:00:00.745Z"}
```

### streaming_transcript.ndjson

```jsonl
{"type":"started","engine_version":"mock-1.0.0","timestamp":"2025-10-01T00:00:00Z"}
{"type":"token","text":"Hello","index":0,"timestamp":"2025-10-01T00:00:00.010Z"}
{"type":"token","text":" world","index":1,"timestamp":"2025-10-01T00:00:00.020Z"}
{"type":"end","tokens_generated":2,"timestamp":"2025-10-01T00:00:00.030Z"}
```

### redacted_errors.log

```
2025-10-01T00:00:00Z ERROR Request failed: Authorization: [REDACTED]
2025-10-01T00:00:01Z ERROR API error: X-API-Key: [REDACTED]
```

### seeds.txt

```
retry_jitter_seed=42
streaming_test_seed=123
```

---

## Generating Artifacts

### During Tests

```bash
# Run tests with proof bundle generation
LLORCH_PROOF_DIR=.proof_bundle cargo test -p worker-adapters-http-util -- --nocapture
```

### Manual Generation

```bash
# Generate proof bundle for specific test
cargo test -p worker-adapters-http-util -- test_retry_with_jitter --nocapture
```

---

## Security Guidelines

1. **No secrets** — Never store API keys, tokens, or passwords
2. **Redaction** — All logs must redact Authorization, X-API-Key, bearer tokens
3. **Review** — Verify redaction before committing artifacts
4. **Rotation** — Rotate any accidentally exposed secrets immediately

---

## Usage in CI

```yaml
- name: Run tests with proof bundle
  run: |
    LLORCH_PROOF_DIR=.proof_bundle cargo test -p worker-adapters-http-util
    
- name: Upload proof bundle
  uses: actions/upload-artifact@v3
  with:
    name: http-util-proof-bundle
    path: libs/worker-adapters/http-util/.proof_bundle/
```

---

## Related

- `libs/proof-bundle` — Proof bundle library
- `.docs/testing/` — Testing guidelines

---

## Status

- **Version**: 0.0.0 (early development)
- **License**: GPL-3.0-or-later
- **Maintainers**: @llama-orch-maintainers
