# proof-bundle

Utilities to emit crate-local proof bundles for tests.

- Standard path: `<crate>/.proof_bundle/<type>/<run_id>/...`
- Env overrides: `LLORCH_PROOF_DIR`, `LLORCH_RUN_ID`
- Recommended `run_id`: `YYYYMMDD-HHMMSS-<git_sha8>`

## Add as dev-dependency

In a crate that writes proof bundles (recommended under dev-dependencies):

```toml
[dev-dependencies]
proof-bundle = { path = "../../libs/proof-bundle" }
```

Adjust the relative path as needed from your crate to `libs/proof-bundle/`.

## Minimal usage

```rust
use proof_bundle::{ProofBundle, TestType};
use serde::Serialize;

#[derive(Serialize)]
struct Event { event: String }

#[test]
fn writes_bundle() -> anyhow::Result<()> {
    let pb = ProofBundle::for_type(TestType::Integration)?;
    // Required header in Markdown/plain-text artifacts:
    pb.write_markdown("test_report.md", "# AUTOGENERATED: Proof Bundle\n# OK\n")?;
    // For NDJSON, prefer a first metadata record indicating autogenerated proof bundle:
    pb.append_ndjson("streaming_transcript", &serde_json::json!({"_meta":"proof_bundle","_note":"autogenerated"}))?;
    pb.append_ndjson("streaming_transcript", &Event { event: "started".into() })?;
    pb.seeds().record(42)?;
    Ok(())
}
```

## API

- `ProofBundle::for_type(TestType)` → opens/creates `<type>/<run_id>/` and returns a handle
- `root()` → `&Path` of the bundle root
- `ensure_dir(sub)` → ensure subdirectory
- `append_ndjson(name, &T)` → appends one JSON per line to `<name>.ndjson`
- `write_json(name, &T)` → writes pretty JSON `<name>.json`
- `write_markdown(name, &str)` → writes `<name>` verbatim
- `seeds().record(seed)` → appends `seed=<N>` to `seeds.txt`

## Test types

```rust
pub enum TestType { Unit, Integration, Contract, Bdd, Determinism, Smoke, E2eHaiku }
```

These map to directory names per `.docs/testing/TEST_TYPES_GUIDE.md`.

## Policy note

- VRAM-only residency during inference (weights/KV/activations). No RAM↔VRAM sharing, UMA/zero-copy, or host-RAM offload; tasks that do not fit fail fast with `POOL_UNAVAILABLE`. See `/.specs/proposals/GPU_ONLY.md` and `/.specs/00_llama-orch.md §2.13`.
