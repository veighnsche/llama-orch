version: '3.8'

services:
  queen:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.queen
    container_name: rbee-queen
    hostname: queen
    ports:
      - "8500:8500"
    networks:
      rbee-test:
        ipv4_address: 172.20.0.10
    environment:
      - RBEE_CONFIG_DIR=/home/rbee/.config/rbee
      - RBEE_DATA_DIR=/home/rbee/.local/share/rbee
      - RUST_LOG=debug
    depends_on:
      - hive-1
      - hive-2

  hive-1:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.hive
    container_name: rbee-hive-1
    hostname: hive-1
    ports:
      - "9001:9000"
      - "2221:22"
    networks:
      rbee-test:
        ipv4_address: 172.20.0.20
    environment:
      - RBEE_CONFIG_DIR=/home/rbee/.config/rbee
      - RBEE_DATA_DIR=/home/rbee/.local/share/rbee
      - RUST_LOG=debug
      - HIVE_ID=hive-1

  hive-2:
    build:
      context: ../..
      dockerfile: tests/docker/Dockerfile.hive
    container_name: rbee-hive-2
    hostname: hive-2
    ports:
      - "9002:9000"
      - "2222:22"
    networks:
      rbee-test:
        ipv4_address: 172.20.0.21
    environment:
      - RBEE_CONFIG_DIR=/home/rbee/.config/rbee
      - RBEE_DATA_DIR=/home/rbee/.local/share/rbee
      - RUST_LOG=debug
      - HIVE_ID=hive-2

networks:
  rbee-test:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16
