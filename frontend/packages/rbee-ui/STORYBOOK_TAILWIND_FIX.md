# Storybook + Tailwind v4 Arbitrary Values Fix

**Date:** 2025-01-15  
**Issue:** Arbitrary values like `translate-y-[100px]` not working in Storybook  
**Root Cause:** Storybook was importing pre-built CSS instead of source CSS

## The Problem

When using Tailwind v4 with Storybook + Vite, arbitrary values (e.g., `translate-y-[100px]`, `w-[300px]`) were not being generated. The classes would appear in the HTML but have no effect.

## Root Cause

Storybook's `preview.ts` was importing the **pre-built CSS** (`dist/index.css`):

```tsx
// ❌ WRONG: Pre-built CSS (static, no JIT)
import '../dist/index.css'
```

This file is generated by PostCSS during the build step and contains only the classes that were present **at build time**. It cannot generate new arbitrary values on-the-fly.

## The Solution

Import the **source CSS** file instead:

```tsx
// ✅ CORRECT: Source CSS (dynamic, JIT enabled)
import '../src/tokens/globals.css'
```

This file contains:
- `@import "tailwindcss"` - Loads Tailwind
- `@source "../**/*.{ts,tsx}"` - Tells Tailwind which files to scan
- Theme imports and custom tokens

When you import the source CSS, the `@tailwindcss/vite` plugin (configured in `.storybook/main.ts`) can perform **JIT compilation** at dev/build time, generating arbitrary values on-demand.

## How It Works

```
┌─────────────────────────────────────────────────────────┐
│ Storybook Dev Server                                    │
├─────────────────────────────────────────────────────────┤
│ 1. Vite starts                                          │
│ 2. @tailwindcss/vite plugin loads                       │
│ 3. preview.ts imports src/tokens/globals.css            │
│ 4. Plugin sees @source directive                        │
│ 5. Plugin scans ../src/**/*.{ts,tsx}                    │
│ 6. Plugin finds: translate-y-[100px]                    │
│ 7. Plugin generates CSS:                                │
│    .translate-y-\[100px\] {                             │
│      --tw-translate-y: 100px;                           │
│      translate: var(--tw-translate-x) var(--tw-translate-y); │
│    }                                                    │
│ 8. CSS injected into browser ✅                         │
└─────────────────────────────────────────────────────────┘
```

## Key Takeaway

**For Tailwind v4 with Vite:**
- **Development/Storybook:** Import source CSS (enables JIT)
- **Production apps:** Can import pre-built CSS (already contains all classes)

## Files Changed

- `.storybook/preview.ts` - Changed import from `../dist/index.css` to `../src/tokens/globals.css`
- `src/tokens/globals.css` - Updated comments to clarify usage

## Verification

1. Start Storybook:
   ```bash
   pnpm run storybook
   ```

2. Open a story with arbitrary values (e.g., BulletListItem with `translate-y-[100px]`)

3. Inspect the element in browser DevTools

4. Verify the CSS class is generated and applied

## References

- [Integrating Storybook with Tailwind CSS v4.1](https://medium.com/@ayomitunde.isijola/integrating-storybook-with-tailwind-css-v4-1-f520ae018c10)
- [Tailwind v4 @source Directive](https://tailwindcss.com/docs/v4-beta#using-source)
