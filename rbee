#!/usr/bin/env bash
# Smart wrapper for rbee-keeper
# Auto-builds if source is newer than binary, then forwards all commands
# Created by: TEAM-162
# Updated by: TEAM-290 (auto-build xtask if not found)
# Updated by: TEAM-334 (used by desktop entry at ~/.local/share/applications/rbee-dev.desktop)
#
# TEAM-334 NOTE: Desktop entry integration
# - Desktop entry: ~/.local/share/applications/rbee-dev.desktop
# - Flow: Desktop entry ‚Üí ./rbee ‚Üí xtask rbee ‚Üí target/debug/rbee-keeper (GUI)
# - Status: ‚ö†Ô∏è NOT WORKING YET (process starts but GUI doesn't appear)
# - See: DESKTOP_ENTRY.md for details

set -e

# Get workspace root
WORKSPACE_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# TEAM-290: Build xtask if it doesn't exist (not just quietly, show output)
if [[ ! -f "$WORKSPACE_ROOT/target/debug/xtask" ]]; then
    echo "üî® Building xtask (not found in target)..."
    cargo build -p xtask
fi

# Call xtask binary directly to avoid recompiling it every time
exec "$WORKSPACE_ROOT/target/debug/xtask" rbee "$@"
