# Proof Bundle — Automated Test Evidence

**⚠️ POLICY CHANGE**: As of 2025-10-02, proof bundles are **crate-local**, not root-level.

This directory contains **documentation and templates** for the proof bundle system.

**Actual proof bundles** are generated in each crate's `.proof_bundle/` directory:
- `bin/worker-orcd-crates/vram-residency/.proof_bundle/`
- `bin/pool-managerd/.proof_bundle/`
- `test-harness/bdd/.proof_bundle/`
- etc.

See: `test-harness/proof-bundle/.specs/PB-001-proof-bundle-location.md` for full policy.

---

## ⚠️ CRITICAL: Generate on ALL Test Results (Pass AND Fail)

**POLICY**: Proof bundles MUST be generated for ALL test runs, regardless of outcome.

- ✅ **Generate when tests pass**
- ✅ **Generate when tests fail** (MORE IMPORTANT)
- ✅ **Generate when tests panic**
- ✅ **Generate when tests timeout**

**Why**: Failed tests are MORE important to document than passing tests. Human auditors need to see:
- What broke
- How it failed
- When it failed
- Why it failed

**Never skip proof bundle generation due to test failures.**

See: `test-harness/proof-bundle/.specs/PB-002-always-generate-bundles.md` for full policy.

---

## ⚠️ CRITICAL: Cleanup Policy

**Problem**: Proof bundle folders with timestamps are **clogging the repository**.

**Solution**: We want **ONLY the LATEST proof bundle** per test type. All older ones should be **automatically removed**.

### Required Behavior:

```bash
# BEFORE test run:
.proof_bundle/unit/20251002-120000-abc123/  ← OLD, should be deleted
.proof_bundle/unit/20251002-115000-def456/  ← OLD, should be deleted

# AFTER test run:
.proof_bundle/unit/20251002-123000-xyz789/  ← NEW, keep this one only
```

### Implementation:

The proof bundle generator now:
1. **Before** creating new bundle: Deletes all existing bundles in that category (unit/bdd/chaos)
2. **Then** creates new bundle with current timestamp
3. Result: Only ONE bundle per test type at any time

**Status**: ✅ **IMPLEMENTED** - Automatic cleanup in `ProofBundle::for_type()`

**Implementation Details**: 
- Code: `test-harness/proof-bundle/src/fs/bundle_root.rs`
- Documentation: [CLEANUP_IMPLEMENTATION.md](./CLEANUP_IMPLEMENTATION.md)

---

## File Formats

- Streams: NDJSON/JSONL; Configs: JSON; Summaries: Markdown; Timings: CSV.
- Always include `test_report.md` summarizing pass/fail, specs covered, and pointers.

## Autogenerated header (required)
- All generated proof bundle artifacts MUST indicate they were automatically generated for a proof bundle.
- For Markdown/CSV/plain-text, the FIRST line MUST be: `# AUTOGENERATED: Proof Bundle`.
- For NDJSON, the FIRST record SHOULD be a metadata record, for example: `{ "_meta": "proof_bundle", "_note": "autogenerated" }`.
- For JSON, prefer a sibling metadata file `<name>.meta` with the first line above. If embedding is acceptable, include a top-level field: `{ "generated_by": "proof-bundle" }`.

## Seeds and determinism
- Record all RNG seeds in `seeds.txt` when applicable.

## Per-type checklists
- See `.proof_bundle/templates/*/README.md` for required files.
- See `.docs/testing/TEST_TYPES_GUIDE.md` and `.docs/testing/types/*.md` for guidance.

## PR expectations
- Attach or link to proof bundle contents in PRs that change behavior.
- Include determinism diffs or SSE transcripts where relevant.

## Retention
- Keep bundles small and redacted. Clean stale run directories as needed pre-1.0.
