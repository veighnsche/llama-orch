# BDD Harness Proof Bundle Template

Required generated artifacts

- features_report.md — feature/scenario pass/fail matrix
- sse_transcripts/ — directory of per-scenario SSE transcripts (*.ndjson)
- request_response_samples/ — redacted HTTP request/response samples
- metrics_snapshots/ — optional scrape samples if used
- logs_redacted/ — redacted logs relevant to scenarios

Notes

- Exercise only public orchestrator APIs. No internal state mutation.
- Reference: `/.specs/72-bdd-harness.md`.

Path layout

- <crate>/.proof_bundle/bdd/<run_id>/
- run_id should be `YYYYMMDD-HHMMSS-<git_sha8>` or set `LLORCH_RUN_ID`.

Environment

- LLORCH_BDD_FEATURE_PATH — select feature or directory
- LLORCH_RUN_ID — optional, groups artifacts per run
- LLORCH_PROOF_DIR — optional, overrides base bundle dir (defaults to `<crate>/.proof_bundle`)

Formats

- Per-scenario SSE transcripts as NDJSON under `sse_transcripts/<feature>__<scenario>.ndjson`
- Redacted HTTP traces as NDJSON under `request_response_samples/`

Autogenerated header (required)

- Markdown/plain-text: first line MUST be `# AUTOGENERATED: Proof Bundle`.
- NDJSON: first record SHOULD be `{ "_meta": "proof_bundle", "_note": "autogenerated" }`.
- JSON: prefer sibling `<name>.meta` file with the header line; embedding `{ "generated_by": "proof-bundle" }` is acceptable.

Example (Rust world hook)

```rust
use std::fs::{create_dir_all, File};
use std::io::Write;
use std::path::PathBuf;

pub struct World { proof_dir: PathBuf /* ... */ }

impl World {
    pub fn init_proof_dir() -> PathBuf {
        let base = std::env::var("LLORCH_PROOF_DIR")
            .map(PathBuf::from)
            .unwrap_or_else(|_| PathBuf::from(env!("CARGO_MANIFEST_DIR")).join(".proof_bundle"));
        let run_id = std::env::var("LLORCH_RUN_ID").unwrap_or_else(|_| {
            let ts = std::time::SystemTime::now().duration_since(std::time::UNIX_EPOCH).unwrap().as_secs();
            format!("{}", ts)
        });
        let dir = base.join("bdd").join(run_id);
        create_dir_all(dir.join("sse_transcripts")).unwrap();
        create_dir_all(dir.join("request_response_samples")).unwrap();
        dir
    }

    pub fn write_sse(&self, feature: &str, scenario: &str, rec: serde_json::Value) {
        let name = format!("{}__{}.ndjson", feature, scenario);
        let path = self.proof_dir.join("sse_transcripts").join(name);
        let mut f = File::options().create(true).append(true).open(path).unwrap();
        writeln!(f, "{}", rec).unwrap();
    }
}
```

Links

- See `.docs/testing/BDD_WIRING.md`, `.docs/testing/types/bdd.md`, and `.docs/testing/TEST_TYPES_GUIDE.md`.
