schema_version: 1
source: .specs/20-orchestratord.md
notes: Extracted from .specs/20-orchestratord.md
requirements:
  OC-CTRL-2001:
    title: '- [] `GET /v1/pools/:id/health` MUST return liveness, readiness, draining, and metrics snapshot fields.'
    section: 1) Control Plane
    level: must
    links:
    - .specs/20-orchestratord.md#1-control-plane
  OC-CTRL-2002:
    title: '- [] `POST /v1/pools/:id/drain` MUST accept a JSON body with `deadline_ms` and MUST begin draining.'
    section: 1) Control Plane
    level: must
    links:
    - .specs/20-orchestratord.md#1-control-plane
  OC-CTRL-2003:
    title: '- [] `POST /v1/pools/:id/reload` MUST atomically switch model references or fail and roll back.'
    section: 1) Control Plane
    level: must
    links:
    - .specs/20-orchestratord.md#1-control-plane
  OC-CTRL-2004:
    title: '- [] Discovery MUST use `GET /v1/capabilities`; `/v1/replicasets` is removed pre‑1.0 and MUST NOT be served.'
    section: 1) Control Plane
    level: must
    links:
    - .specs/20-orchestratord.md#1-control-plane
  OC-CTRL-2010:
    title: '- [] `POST /v1/tasks` MUST perform admission checks (ctx, token budget) before enqueue.'
    section: 2) Data Plane — OrchQueue v1
    level: must
    links:
    - .specs/20-orchestratord.md#2-data-plane-orchqueue-v1
  OC-CTRL-2011:
    title: '- [] On queue full, server MUST reply `429` and include `Retry-After` and `X-Backoff-Ms`. A JSON body MUST include the full policy label.'
    section: 2) Data Plane — OrchQueue v1
    level: must
    links:
    - .specs/20-orchestratord.md#2-data-plane-orchqueue-v1
  OC-CTRL-2012:
    title: '- [] `POST /v1/tasks/:id/cancel` MUST be race‑free; no tokens may be emitted after cancel.'
    section: 2) Data Plane — OrchQueue v1
    level: must
    links:
    - .specs/20-orchestratord.md#2-data-plane-orchqueue-v1
  OC-CTRL-2020:
    title: '- [] `GET /v1/tasks/:id/stream` MUST emit events `started`, `token`, `metrics`, `end`, `error`.'
    section: 3) SSE Framing
    level: must
    links:
    - .specs/20-orchestratord.md#3-sse-framing
  OC-CTRL-2021:
    title: '- [] `started` MUST include `queue_position` and `predicted_start_ms` when available.'
    section: 3) SSE Framing
    level: must
    links:
    - .specs/20-orchestratord.md#3-sse-framing
  OC-CTRL-2022:
    title: '- [] Event payloads MUST be well‑formed JSON; ordering MUST be per stream.'
    section: 3) SSE Framing
    level: must
    links:
    - .specs/20-orchestratord.md#3-sse-framing
  OC-CTRL-2023:
    title: '- [] The `metrics` SSE frames SHOULD include fields helpful for client-side planning under load, such as `on_time_probability` (number), `queue_depth` (int), an'
    section: 11) SSE Metrics – Scheduling Signals
    level: should
    links:
    - .specs/20-orchestratord.md#11-sse-metrics-scheduling-signals
  OC-CTRL-2030:
    title: '- [] Errors MUST include a stable `code` field: `ADMISSION_REJECT`, `QUEUE_FULL_DROP_LRU`, `INVALID_PARAMS`, `POOL_UNREADY`, `POOL_UNAVAILABLE`, `REPLICA_EXHAUS'
    section: 4) Error Taxonomy
    level: must
    links:
    - .specs/20-orchestratord.md#4-error-taxonomy
  OC-CTRL-2031:
    title: '- [] Errors SHOULD include the `engine` and `pool_id` when applicable.'
    section: 4) Error Taxonomy
    level: should
    links:
    - .specs/20-orchestratord.md#4-error-taxonomy
  OC-CTRL-2040:
    title: '- [] Control and data plane MUST be gated by AuthN/AuthZ; API keys acceptable day‑1.'
    section: 5) Security
    level: must
    links:
    - .specs/20-orchestratord.md#5-security
  OC-CTRL-2041:
    title: '- [] Logs MUST NOT leak secrets or API keys.'
    section: 5) Security
    level: must
    links:
    - .specs/20-orchestratord.md#5-security
  OC-CTRL-2050:
    title: '- [] Admission logs and `started` MUST include `queue_position` and `predicted_start_ms` when available.'
    section: 6) Observability
    level: must
    links:
    - .specs/20-orchestratord.md#6-observability
  OC-CTRL-2051:
    title: '- [] Metrics MUST include queue depth, reject/drop rates, latency percentiles, and error counts by class.'
    section: 6) Observability
    level: must
    links:
    - .specs/20-orchestratord.md#6-observability
  OC-CTRL-2052:
    title: '- [] Responses that include headers SHOULD include `X-Correlation-Id` (except `204 No Content`) to enable client trace stitching.'
    section: 6) Observability
    level: should
    links:
    - .specs/20-orchestratord.md#6-observability
  OC-CTRL-2060:
    title: '- [] The server MUST expose capability information via `GET /v1/capabilities` covering engines, ctx_max, declared concurrency, rate limits, features.'
    section: 8) Capabilities & Discovery
    level: must
    links:
    - .specs/20-orchestratord.md#8-capabilities-discovery
  OC-CTRL-2061:
    title: '- [] Capability payloads MUST include an API version field compatible with OpenAPI `info.version`, enabling the CLI to pin a compatible range.'
    section: 8) Capabilities & Discovery
    level: must
    links:
    - .specs/20-orchestratord.md#8-capabilities-discovery
  OC-CTRL-2065:
    title: '- [] The server SHOULD provide `POST /v1/artifacts` to persist structured artifacts (plans, summaries, diffs, traces) with content-addressed IDs and tags. Reque'
    section: 9) Artifact Registry (Optional, Recommended)
    level: must
    links:
    - .specs/20-orchestratord.md#9-artifact-registry-optional-recommended
  OC-CTRL-2066:
    title: '- [] The server SHOULD provide `GET /v1/artifacts/{id}` to retrieve artifacts by ID, including metadata (tags, lineage, timestamps). Authorization MUST be enfor'
    section: 9) Artifact Registry (Optional, Recommended)
    level: must
    links:
    - .specs/20-orchestratord.md#9-artifact-registry-optional-recommended
  OC-CTRL-2068:
    title: '- [] Per-session budgets (token/time/cost) SHOULD be supported and enforced at admission or scheduling time. When budgets are active, the server SHOULD surface '
    section: 10) Budgets & Guardrails
    level: should
    links:
    - .specs/20-orchestratord.md#10-budgets-guardrails
