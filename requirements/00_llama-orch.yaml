schema_version: 1
source: .specs/00_llama-orch.md
notes: Extracted from .specs/00_llama-orch.md
requirements:
  ORCH-1101:
    title: Hosts are Linux, headless, with NVIDIA drivers + CUDA runtime installed. ()
    section: 1. Platform Assumptions
    level: info
    links:
    - .specs/00_llama-orch.md#1-platform-assumptions
  ORCH-1102:
    title: Inference MUST run on NVIDIA GPUs. CPU-only or non-NVIDIA machines MAY run tooling but MUST NOT serve inference. ()
    section: 1. Platform Assumptions
    level: must
    links:
    - .specs/00_llama-orch.md#1-platform-assumptions
  ORCH-1103:
    title: Mixed GPUs (e.g., RTX 3090 + 3060) are supported; placement rules must account for differing VRAM. ()
    section: 1. Platform Assumptions
    level: must
    links:
    - .specs/00_llama-orch.md#1-platform-assumptions
  ORCH-2002:
    title: SSE framing MUST stay `started`, `token`, optional `metrics`, `end`, `error`. `started` MUST include `queue_position` and `predicted_start_ms` when available. (
    section: 2.5 Streaming & Determinism
    level: must
    links:
    - .specs/00_llama-orch.md#25-streaming-determinism
  ORCH-2007:
    title: Backpressure MUST reply with HTTP 429, `Retry-After`, `X-Backoff-Ms`, and a JSON body containing `policy_label`, `retriable`, `retry_after_ms`. ()
    section: 2.2 Admission & Queueing
    level: must
    links:
    - .specs/00_llama-orch.md#22-admission-queueing
  ORCH-3000:
    title: Provide deterministic, observable orchestration of NVIDIA-backed LLM workers on a single workstation with one or more GPUs. ()
    section: 0. Scope & Goals
    level: info
    links:
    - .specs/00_llama-orch.md#0-scope-goals
  ORCH-3001:
    title: Workers MUST be one-model/one-device-mask processes. ()
    section: 2.1 Process Model & Preload
    level: must
    links:
    - .specs/00_llama-orch.md#21-process-model-preload
  ORCH-3002:
    title: 'Keep configuration lightweight: filesystem storage, no clustered control plane. ()'
    section: 0. Scope & Goals
    level: info
    links:
    - .specs/00_llama-orch.md#0-scope-goals
  ORCH-3003:
    title: 'Optimise for multi-agent developer workflows: low queue latency, clear feedback, reliable catalog/artifact handling. ()'
    section: 0. Scope & Goals
    level: info
    links:
    - .specs/00_llama-orch.md#0-scope-goals
  ORCH-3004:
    title: 'Each pool MUST expose a bounded FIFO queue with two priorities: `interactive` and `batch`. ()'
    section: 2.2 Admission & Queueing
    level: must
    links:
    - .specs/00_llama-orch.md#22-admission-queueing
  ORCH-3005:
    title: Full-queue policy MUST be either `reject` or `drop-lru`; the chosen policy MUST be documented. ()
    section: 2.2 Admission & Queueing
    level: must
    links:
    - .specs/00_llama-orch.md#22-admission-queueing
  ORCH-3006:
    title: Simple per-token or per-request throttles SHOULD be configurable per API token before enqueue; defaults MAY be permissive. ()
    section: 2.2 Admission & Queueing
    level: should
    links:
    - .specs/00_llama-orch.md#22-admission-queueing
  ORCH-3009:
    title: Session affinity SHOULD keep a session on its previous replica when possible; failovers MUST surface `kv_warmth=false`. ()
    section: 2.3 Placement & Scheduling
    level: must
    links:
    - .specs/00_llama-orch.md#23-placement-scheduling
  ORCH-3010:
    title: Scheduler MUST only dispatch to Ready replicas and respect explicit device masks. ( & ORCH-3011)
    section: 2.3 Placement & Scheduling
    level: must
    links:
    - .specs/00_llama-orch.md#23-placement-scheduling
  ORCH-3011:
    title: Scheduler MUST only dispatch to Ready replicas and respect explicit device masks. (ORCH-3010 & )
    section: 2.3 Placement & Scheduling
    level: must
    links:
    - .specs/00_llama-orch.md#23-placement-scheduling
  ORCH-3012:
    title: 'Default placement heuristic MUST use least-loaded selection with VRAM awareness: prefer the GPU with the most free VRAM, then fewest active slots; tie-break det'
    section: 2.3 Placement & Scheduling
    level: must
    links:
    - .specs/00_llama-orch.md#23-placement-scheduling
  ORCH-3014:
    title: Queue guardrails MUST reject requests that exceed model context or declared budgets before enqueue. ()
    section: 2.2 Admission & Queueing
    level: must
    links:
    - .specs/00_llama-orch.md#22-admission-queueing
  ORCH-3021:
    title: 'Sessions are short-lived: default TTL ≤ 10 minutes, default max 8 turns. ()'
    section: 2.4 Sessions & Budgets
    level: info
    links:
    - .specs/00_llama-orch.md#24-sessions-budgets
  ORCH-3022:
    title: KV cache usage MUST be bounded; metrics MUST expose KV pressure. ()
    section: 2.4 Sessions & Budgets
    level: must
    links:
    - .specs/00_llama-orch.md#24-sessions-budgets
  ORCH-3023:
    title: Cross-worker KV migration is disallowed; failover MUST surface `kv_migrated=false`. ()
    section: 2.4 Sessions & Budgets
    level: must
    links:
    - .specs/00_llama-orch.md#24-sessions-budgets
  ORCH-3024:
    title: Each job MUST carry a unique `job_id`. ()
    section: 2.5 Streaming & Determinism
    level: must
    links:
    - .specs/00_llama-orch.md#25-streaming-determinism
  ORCH-3026:
    title: Cancellation MUST be race-free; no tokens may be emitted after cancel. ()
    section: 2.5 Streaming & Determinism
    level: must
    links:
    - .specs/00_llama-orch.md#25-streaming-determinism
  ORCH-3027:
    title: Logs MUST include `job_id`, `session_id`, `engine`, `engine_version`, `pool_id`, `replica_id`, `queue_position`, `predicted_start_ms`, `tokens_in`, `tokens_out`
    section: 2.8 Observability
    level: must
    links:
    - .specs/00_llama-orch.md#28-observability
  ORCH-3028:
    title: 'Minimum Prometheus metrics: queue depth, tasks enqueued/started/canceled/rejected, tokens in/out, GPU util, VRAM used, optional KV cache ratio. ()'
    section: 2.8 Observability
    level: info
    links:
    - .specs/00_llama-orch.md#28-observability
  ORCH-3029:
    title: SSE framing MUST stay `started`, `token`, optional `metrics`, `end`, `error`. `started` MUST include `queue_position` and `predicted_start_ms` when available. (
    section: 2.5 Streaming & Determinism
    level: must
    links:
    - .specs/00_llama-orch.md#25-streaming-determinism
  ORCH-3030:
    title: Spec changes MUST follow `.docs/PROCESS.md`. ()
    section: 6. Documentation & Process
    level: must
    links:
    - .specs/00_llama-orch.md#6-documentation-process
  ORCH-3031:
    title: Lifecycle states are limited to `Active` and `Retired`; legacy `Draft`/`Canary` states are removed. Catalog state transitions MUST update pool readiness and rel
    section: 2.6 Catalog, Artifacts & Reloads
    level: must
    links:
    - .specs/00_llama-orch.md#26-catalog-artifacts-reloads
  ORCH-3035:
    title: 'Home profile: there is no AuthN/AuthZ on the control/data planes; they are open locally. Future profiles MAY add auth behind features. ()'
    section: 2.7 Security & Policy
    level: may
    links:
    - .specs/00_llama-orch.md#27-security-policy
  ORCH-3037:
    title: Catalog APIs MUST persist model metadata locally and allow verification flows that warn (rather than fail) when signatures/SBOMs are missing. ()
    section: 2.6 Catalog, Artifacts & Reloads
    level: must
    links:
    - .specs/00_llama-orch.md#26-catalog-artifacts-reloads
  ORCH-3038:
    title: 'Pool drain/reload MUST be atomic and reversible: reload success toggles Ready, failure rolls back. (ORCH-3031 & )'
    section: 2.6 Catalog, Artifacts & Reloads
    level: must
    links:
    - .specs/00_llama-orch.md#26-catalog-artifacts-reloads
  ORCH-3039:
    title: VRAM OOM MUST be distinguished from host OOM; VRAM OOM SHOULD trigger capacity re-estimation. ()
    section: 2.10 Resilience & Recovery
    level: must
    links:
    - .specs/00_llama-orch.md#210-resilience-recovery
  ORCH-3040:
    title: Circuit breakers SHOULD shed load if SLOs are breached persistently. ()
    section: 2.10 Resilience & Recovery
    level: should
    links:
    - .specs/00_llama-orch.md#210-resilience-recovery
  ORCH-3044:
    title: TODO tracker updates are mandatory after spec/contract/test/code changes. ()
    section: 6. Documentation & Process
    level: info
    links:
    - .specs/00_llama-orch.md#6-documentation-process
  ORCH-3045:
    title: 'Determinism is the default: identical `{prompt, parameters, seed, sampler_profile_version, engine_version, model_digest}` on the same replica MUST yield identic'
    section: 2.5 Streaming & Determinism
    level: must
    links:
    - .specs/00_llama-orch.md#25-streaming-determinism
  ORCH-3046:
    title: Replica sets MUST pin `engine_version` and `sampler_profile_version`; mixed versions are not allowed. ()
    section: 2.5 Streaming & Determinism
    level: must
    links:
    - .specs/00_llama-orch.md#25-streaming-determinism
  ORCH-3049:
    title: Startup self-tests MUST cover preload, minimal decode, cancel, metrics/log emission. ()
    section: 5. Testing & Validation
    level: must
    links:
    - .specs/00_llama-orch.md#5-testing-validation
  ORCH-3050:
    title: Determinism suite MUST verify byte-exact streams across replicas per engine (llama.cpp with `--parallel 1 --no-cont-batching`, others in single-slot mode). ()
    section: 5. Testing & Validation
    level: must
    links:
    - .specs/00_llama-orch.md#5-testing-validation
  ORCH-3051:
    title: Chaos/load tests SHOULD exercise drain/reload, driver resets, queue saturation, cancel. ()
    section: 5. Testing & Validation
    level: should
    links:
    - .specs/00_llama-orch.md#5-testing-validation
  ORCH-3052:
    title: Device masks are explicit; spillover is forbidden. ()
    section: 3. GPU Topology & Device Management
    level: info
    links:
    - .specs/00_llama-orch.md#3-gpu-topology-device-management
  ORCH-3053:
    title: Driver resets/ECC events MUST be surfaced distinctly; restart storms MUST be limited with backoff. ()
    section: 3. GPU Topology & Device Management
    level: must
    links:
    - .specs/00_llama-orch.md#3-gpu-topology-device-management
  ORCH-3054:
    title: llama.cpp adapter MUST implement health, properties, completion SSE, cancel, metrics. ()
    section: 4. Engines & Adapters (Informative)
    level: must
    links:
    - .specs/00_llama-orch.md#4-engines-adapters-informative
  ORCH-3055:
    title: vLLM adapter MUST capture engine version and expose OpenAI-compatible completion/embedding paths internally. ()
    section: 4. Engines & Adapters (Informative)
    level: must
    links:
    - .specs/00_llama-orch.md#4-engines-adapters-informative
  ORCH-3056:
    title: TGI adapter MUST support `/generate`, `/info`, and optional OpenAI-compatible path. ()
    section: 4. Engines & Adapters (Informative)
    level: must
    links:
    - .specs/00_llama-orch.md#4-engines-adapters-informative
  ORCH-3057:
    title: Triton/TensorRT-LLM adapter MUST expose health/metadata, infer (HTTP/gRPC), and metrics. ()
    section: 4. Engines & Adapters (Informative)
    level: must
    links:
    - .specs/00_llama-orch.md#4-engines-adapters-informative
  ORCH-3058:
    title: Mock adapter MUST remain for tests and support fault injection. ()
    section: 4. Engines & Adapters (Informative)
    level: must
    links:
    - .specs/00_llama-orch.md#4-engines-adapters-informative
  ORCH-3080:
    title: A lightweight policy hook MUST exist so outbound HTTP tooling can be allowed/denied per deployment. ()
    section: 2.7 Security & Policy
    level: must
    links:
    - .specs/00_llama-orch.md#27-security-policy
  ORCH-3090:
    title: The data-plane `TaskRequest.model_ref` selects the desired model artifact. ()
    section: 2.11 Model Selection & Auto-Fetch Policy
    level: info
    links:
    - .specs/00_llama-orch.md#211-model-selection-autofetch-policy
  ORCH-3091:
    title: If referenced artifacts are not present locally, the system SHOULD auto-fetch into its model cache when provisioning policy allows; otherwise it MUST reply with
    section: 2.11 Model Selection & Auto-Fetch Policy
    level: must
    links:
    - .specs/00_llama-orch.md#211-model-selection-autofetch-policy
  ORCH-3092:
    title: Home profile (Arch/CachyOS) MAY offer opt-in package installs for required tooling (e.g., `python-huggingface-hub`) via `pacman`/AUR when `allow_package_install
    section: 2.11 Model Selection & Auto-Fetch Policy
    level: may
    links:
    - .specs/00_llama-orch.md#211-model-selection-autofetch-policy
  ORCH-3095:
    title: The API MUST expose capability information via `GET /v1/capabilities` covering engine versions, max context, supported workloads, and declared concurrency. `GET
    section: 2.9 Capability Discovery
    level: must
    links:
    - .specs/00_llama-orch.md#29-capability-discovery
  ORCH-3096:
    title: Capability payloads MUST include an API version compatible with OpenAPI `info.version`. ()
    section: 2.9 Capability Discovery
    level: must
    links:
    - .specs/00_llama-orch.md#29-capability-discovery
  ORCH-3097:
    title: When checksums/digests are provided, verification MUST be performed and MUST fail pre‑admission on mismatch; otherwise verification MAY proceed with warnings.
    section: 2.6 Catalog, Artifacts & Reloads
    level: must
    links:
    - .specs/00_llama-orch.md#26-catalog-artifacts-reloads
  ORCH-3098:
    title: Artifact registry SHOULD expose `POST /v1/artifacts` + `GET /v1/artifacts/{id}` for plans/diffs/traces stored on local disk. (ORCH-3097 & )
    section: 2.6 Catalog, Artifacts & Reloads
    level: should
    links:
    - .specs/00_llama-orch.md#26-catalog-artifacts-reloads
  ORCH-3099:
    title: Per-session token/time/cost budgets SHOULD be configurable; enforcement MUST occur before enqueue when enabled. ()
    section: 2.4 Sessions & Budgets
    level: must
    links:
    - .specs/00_llama-orch.md#24-sessions-budgets
  ORCH-3100:
    title: SSE `metrics` frames SHOULD include additive JSON (`queue_depth`, `on_time_probability`, `kv_warmth`, remaining budgets). ()
    section: 2.8 Observability
    level: should
    links:
    - .specs/00_llama-orch.md#28-observability
  ORCH-3200:
    title: The program provisions and manages engines automatically per pool; operators SHOULD NOT be required to pre-install or manually launch engines. ()
    section: 2.12 Engine Provisioning & Preflight
    level: should
    links:
    - .specs/00_llama-orch.md#212-engine-provisioning-preflight
  ORCH-3201:
    title: 'Provisioning modes (mirrors `contracts/config-schema`): ()'
    section: 2.12 Engine Provisioning & Preflight
    level: info
    links:
    - .specs/00_llama-orch.md#212-engine-provisioning-preflight
  ORCH-3202:
    title: 'Preflight MUST check required tools and environment for the selected mode and either: (a) provision missing tools when policy allows, or (b) fail fast with acti'
    section: 2.12 Engine Provisioning & Preflight
    level: must
    links:
    - .specs/00_llama-orch.md#212-engine-provisioning-preflight
  ORCH-3203:
    title: 'Typical tools: `git`, `cmake`, `make`, `gcc`; engine-specific: `nvcc` (CUDA), `huggingface-cli` (HF), `aws` (S3), `oras` (OCI). ()'
    section: 2.12 Engine Provisioning & Preflight
    level: info
    links:
    - .specs/00_llama-orch.md#212-engine-provisioning-preflight
  ORCH-3204:
    title: 'Home profile Arch/CachyOS: when `allow_package_installs=true`, the system MAY install missing tools via `pacman`/AUR non-interactively when possible; otherwise '
    section: 2.12 Engine Provisioning & Preflight
    level: must
    links:
    - .specs/00_llama-orch.md#212-engine-provisioning-preflight
  ORCH-3205:
    title: 'Cache & install locations: ()'
    section: 2.12 Engine Provisioning & Preflight
    level: info
    links:
    - .specs/00_llama-orch.md#212-engine-provisioning-preflight
  ORCH-3206:
    title: Outbound network/tooling MUST be policy-gated (same policy hook as §2.7 Security & Policy). Operators MUST be able to disable downloads globally. ()
    section: 2.12 Engine Provisioning & Preflight
    level: must
    links:
    - .specs/00_llama-orch.md#212-engine-provisioning-preflight
  ORCH-3207:
    title: Provisioning MUST produce a deterministic plan (steps) and logs suitable for inclusion in artifacts; a pool MUST only transition to Ready after successful engin
    section: 2.12 Engine Provisioning & Preflight
    level: must
    links:
    - .specs/00_llama-orch.md#212-engine-provisioning-preflight
  ORCH-3300:
    title: '[] Significant events/spans SHOULD attach a short narration string alongside structured fields under a consistent key (e.g., `human`).'
    section: 2.8.1 Human‑Readable Narration (ORCH-33xx)
    level: should
    links:
    - .specs/00_llama-orch.md#281-humanreadable-narration-orch33xx
  ORCH-3302:
    title: '[] Narration MUST NOT include secrets or PII; redaction helpers MUST be used by emitters.'
    section: 2.8.1 Human‑Readable Narration (ORCH-33xx)
    level: must
    links:
    - .specs/00_llama-orch.md#281-humanreadable-narration-orch33xx
  ORCH-3303:
    title: '[] Narration MUST work with both pretty console and JSON outputs; JSON remains the default in CI.'
    section: 2.8.1 Human‑Readable Narration (ORCH-33xx)
    level: must
    links:
    - .specs/00_llama-orch.md#281-humanreadable-narration-orch33xx
  ORCH-3310:
    title: '[] Canonicalize `decode_time_ms` as the field name; where `decode_ms` exists, implementations MUST preserve compatibility during migration.'
    section: 2.8.1 Human‑Readable Narration (ORCH-33xx)
    level: must
    links:
    - .specs/00_llama-orch.md#281-humanreadable-narration-orch33xx
