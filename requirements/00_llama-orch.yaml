schema_version: 1
source: .specs/00_llama-orch.md
notes: Derived from home profile spec (ORCH-3xxx).
requirements:
  ORCH-3001:
    title: Workers MUST be one-model/one-device-mask processes.
    section: Process model & preload
    level: must
  ORCH-3002:
    title: Pools MUST preload models and only report Ready after success.
    section: Process model & preload
    level: must
  ORCH-3003:
    title: Preload MUST fail fast when VRAM/host RAM is insufficient.
    section: Process model & preload
    level: must
  ORCH-3004:
    title: Queues MUST be bounded FIFO with priorities `interactive` and `batch`.
    section: Admission & queueing
    level: must
  ORCH-3005:
    title: Queue full policy MUST be either reject or drop-lru and be documented.
    section: Admission & queueing
    level: must
  ORCH-3006:
    title: Optional per-token or per-request throttles SHOULD be configurable per API token.
    section: Admission & queueing
    level: should
  ORCH-3009:
    title: Session affinity SHOULD keep a session on its previous replica when possible.
    section: Placement & scheduling
    level: should
  ORCH-3010:
    title: Scheduler MUST dispatch only to Ready replicas.
    section: Placement & scheduling
    level: must
  ORCH-3011:
    title: Placement MUST respect device masks; no spillover.
    section: Placement & scheduling
    level: must
  ORCH-3012:
    title: Default placement heuristic MUST prefer the GPU with the most free VRAM/slots.
    section: Placement & scheduling
    level: must
  ORCH-3014:
    title: Context length MUST be validated before enqueue and rejected if too large.
    section: Guardrails
    level: must
  ORCH-3021:
    title: Sessions SHOULD default to TTL ≤ 10 minutes and ≤ 8 turns.
    section: Sessions & budgets
    level: should
  ORCH-3022:
    title: KV cache usage MUST be bounded and exposed via metrics.
    section: Sessions & budgets
    level: must
  ORCH-3023:
    title: KV migration is disabled; failover MUST surface kv_warmth=false.
    section: Sessions & budgets
    level: must
  ORCH-3024:
    title: Every job MUST carry a unique job_id.
    section: Streaming & determinism
    level: must
  ORCH-3026:
    title: Cancellation MUST be race-free; no tokens after cancel.
    section: Streaming & determinism
    level: must
  ORCH-3027:
    title: Logs MUST include queue metadata (queue_position, predicted_start_ms) and core identifiers.
    section: Observability
    level: must
  ORCH-3028:
    title: Minimum Prometheus metrics MUST include queue depth, task counters, tokens in/out, GPU & VRAM gauges.
    section: Observability
    level: must
  ORCH-3029:
    title: `started` SSE event MUST include queue_position and predicted_start_ms when available.
    section: Streaming & determinism
    level: must
  ORCH-3031:
    title: Drain/reload MUST be atomic and reversible.
    section: Catalog & lifecycle
    level: must
  ORCH-3035:
    title: Control and data planes MUST be gated by an API token.
    section: Security & policy
    level: must
  ORCH-3037:
    title: Catalog verification SHOULD warn (not fail) when signatures/SBOMs are missing.
    section: Catalog & lifecycle
    level: should
  ORCH-3038:
    title: Driver errors MUST mark pools unready and restart with backoff.
    section: Resilience
    level: must
  ORCH-3045:
    title: Determinism is required: identical input on the same replica MUST yield the same stream.
    section: Streaming & determinism
    level: must
  ORCH-3046:
    title: Replica sets MUST pin engine_version and sampler_profile_version.
    section: Streaming & determinism
    level: must
  ORCH-3049:
    title: Startup self-tests MUST cover preload, minimal decode, cancel, telemetry.
    section: Testing & validation
    level: must
  ORCH-3050:
    title: Determinism suite MUST run per engine with byte-exact comparison.
    section: Testing & validation
    level: must
  ORCH-3051:
    title: Haiku E2E test MUST run on real hardware with REQUIRE_REAL_LLAMA=1.
    section: Testing & validation
    level: must
  ORCH-3052:
    title: Device masks are explicit; cross-GPU splits are opt-in via tensor_split.
    section: GPU topology
    level: must
  ORCH-3053:
    title: Driver resets/ECC events MUST be surfaced distinctly and restart storms bounded.
    section: GPU topology
    level: must
  ORCH-3054:
    title: llama.cpp adapter MUST implement health, properties, completion SSE, cancel, metrics.
    section: Engines & adapters
    level: must
  ORCH-3055:
    title: vLLM adapter MUST capture engine version and expose OpenAI-compatible completions internally.
    section: Engines & adapters
    level: must
  ORCH-3056:
    title: TGI adapter MUST support /generate, /info, and optional OpenAI-compatible path.
    section: Engines & adapters
    level: must
  ORCH-3057:
    title: Triton/TensorRT-LLM adapter MUST expose health/metadata and infer.
    section: Engines & adapters
    level: must
  ORCH-3058:
    title: Mock adapter MUST remain available for tests with fault injection.
    section: Engines & adapters
    level: must
  ORCH-3080:
    title: Tooling policy hook MUST exist to allow/deny outbound HTTP actions with audit logs.
    section: Security & policy
    level: must
  ORCH-3095:
    title: Capability discovery MUST expose engine limits and concurrency hints.
    section: Capability discovery
    level: must
  ORCH-3096:
    title: Capability payload MUST include API version compatible with OpenAPI info.version.
    section: Capability discovery
    level: must
  ORCH-3097:
    title: Artifact registry SHOULD provide POST /v1/artifacts to store plans/diffs locally.
    section: Catalog & lifecycle
    level: should
  ORCH-3098:
    title: Artifact registry SHOULD provide GET /v1/artifacts/{id} with metadata and auth.
    section: Catalog & lifecycle
    level: should
  ORCH-3099:
    title: Budgets (token/time/cost) SHOULD be enforceable at admission and reflected in telemetry.
    section: Sessions & budgets
    level: should
  ORCH-3100:
    title: SSE metrics frames SHOULD include queue_depth, on_time_probability, kv_warmth, budgets.
    section: Observability
    level: should

  HME-001:
    title: All services MUST run on a single workstation host.
    section: Home overlay
    level: must
  HME-002:
    title: Default bind MUST be loopback; LAN exposure is opt-in and documented.
    section: Home overlay
    level: must
  HME-010:
    title: Mixed GPUs (24 GB + 12 GB reference) MUST be scheduled without manual pinning.
    section: Home overlay
    level: must
  HME-012:
    title: Capability response MUST include concurrency hints based on mixed-GPU capacity.
    section: Home overlay
    level: must
  HME-020:
    title: CLI MUST receive queue metadata (queue_position, predicted_start_ms, budgets).
    section: Home overlay
    level: must
  HME-022:
    title: Artifact downloads MUST be reachable from the developer box (tunnel or LAN).
    section: Home overlay
    level: must
  HME-040:
    title: Reference environment smoke MUST pass before release.
    section: Home overlay
    level: must
