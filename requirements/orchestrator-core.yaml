schema_version: 1
source: .specs/10-orchestrator-core.md
notes: Extracted from .specs/10-orchestrator-core.md
requirements:
  OC-CORE-1001:
    title: '- [] Each Pool MUST expose a bounded FIFO queue per priority class.'
    section: 1) Queue & Admission
    level: must
    links:
    - .specs/10-orchestrator-core.md#1-queue-admission
  OC-CORE-1002:
    title: '- [] Admission MUST reject when the queue is full according to configured policy (reject/drop-lru/shed-low-priority).'
    section: 1) Queue & Admission
    level: must
    links:
    - .specs/10-orchestrator-core.md#1-queue-admission
  OC-CORE-1003:
    title: '- [] Enqueue MUST be O(1) amortized and MUST preserve request arrival order within the same priority.'
    section: 1) Queue & Admission
    level: must
    links:
    - .specs/10-orchestrator-core.md#1-queue-admission
  OC-CORE-1004:
    title: '- [] Dequeue MUST prefer higher priority and MUST respect FIFO order within a priority class.'
    section: 1) Queue & Admission
    level: must
    links:
    - .specs/10-orchestrator-core.md#1-queue-admission
  OC-CORE-1005:
    title: '- [] Cancellation MUST remove the task from the queue or mark the slot so it is not dispatched.'
    section: 1) Queue & Admission
    level: must
    links:
    - .specs/10-orchestrator-core.md#1-queue-admission
  OC-CORE-1010:
    title: '- [] Scheduler MUST dispatch only to Ready replicas.'
    section: 2) Scheduling & Placement
    level: must
    links:
    - .specs/10-orchestrator-core.md#2-scheduling-placement
  OC-CORE-1011:
    title: '- [] Placement MUST respect device masks; cross‑mask spillover MUST NOT occur.'
    section: 2) Scheduling & Placement
    level: must
    links:
    - .specs/10-orchestrator-core.md#2-scheduling-placement
  OC-CORE-1012:
    title: '- [] Placement MUST use least‑loaded selection with VRAM awareness across replicas of the same replica set: prefer the replica with the most free VRAM, then f'
    section: 2) Scheduling & Placement
    level: must
    links:
    - .specs/10-orchestrator-core.md#2-scheduling-placement
  OC-CORE-1013:
    title: '- [] Session affinity SHOULD keep a session on its last good replica when possible.'
    section: 2) Scheduling & Placement
    level: should
    links:
    - .specs/10-orchestrator-core.md#2-scheduling-placement
  OC-CORE-1014:
    title: '- [] `ModelRequirements` MUST be derivable from catalog metadata plus adapter/engine capability metadata. Missing fields (e.g., `quant`) MAY remain `None` if no'
    section: 2A) Data Types — Canonical (authoritative)
    level: must
    links:
    - .specs/10-orchestrator-core.md#2a-data-types-canonical-authoritative
  OC-CORE-1015:
    title: '- [] `ctx_max` MUST be the effective user-visible limit considering tokenizer/template overhead.'
    section: 2A) Data Types — Canonical (authoritative)
    level: must
    links:
    - .specs/10-orchestrator-core.md#2a-data-types-canonical-authoritative
  OC-CORE-1016:
    title: '- [] Feasibility MUST require `ctx_max_supported >= ModelRequirements.ctx_max` and feature subset satisfaction (when `extensions` are required). Engine/model mi'
    section: 2A) Data Types — Canonical (authoritative)
    level: must
    links:
    - .specs/10-orchestrator-core.md#2a-data-types-canonical-authoritative
  OC-CORE-1017:
    title: '- [] Deterministic tie-break mapping: selection ordering MUST be defined as a tuple sort `(free_vram_mb desc, active_slots asc, replica_id asc)`.'
    section: 2A) Data Types — Canonical (authoritative)
    level: must
    links:
    - .specs/10-orchestrator-core.md#2a-data-types-canonical-authoritative
  OC-CORE-1020:
    title: '- [] Context length MUST be ≤ model limit; otherwise reject before enqueue.'
    section: 3) Capacity & Guardrails
    level: must
    links:
    - .specs/10-orchestrator-core.md#3-capacity-guardrails
  OC-CORE-1021:
    title: '- [] Token budget (prompt + generation) MUST be validated pre‑admission.'
    section: 3) Capacity & Guardrails
    level: must
    links:
    - .specs/10-orchestrator-core.md#3-capacity-guardrails
  OC-CORE-1022:
    title: '- [] Watchdog MUST abort stuck Jobs with configurable wall/idle timeouts.'
    section: 3) Capacity & Guardrails
    level: must
    links:
    - .specs/10-orchestrator-core.md#3-capacity-guardrails
  OC-CORE-1023:
    title: '- [] When per‑session budgets (token/time/cost) are configured, admission and/or scheduling MUST enforce remaining budget and reject infeasible requests with '
    section: 3) Capacity & Guardrails
    level: must
    links:
    - .specs/10-orchestrator-core.md#3-capacity-guardrails
  OC-CORE-1024:
    title: '- [] Budget accounting SHOULD be surfaced to clients via SSE `metrics` frames and/or response headers.'
    section: 3) Capacity & Guardrails
    level: should
    links:
    - .specs/10-orchestrator-core.md#3-capacity-guardrails
  OC-CORE-1030:
    title: '- [] Within a replica set, identical {prompt, parameters, seed, sampler_profile_version, engine_version, model_digest} MUST yield identical token streams.'
    section: 4) Determinism
    level: must
    links:
    - .specs/10-orchestrator-core.md#4-determinism
  OC-CORE-1031:
    title: '- [] Replica sets MUST pin engine_version and sampler_profile_version; mixed replicas MUST NOT share a set.'
    section: 4) Determinism
    level: must
    links:
    - .specs/10-orchestrator-core.md#4-determinism
  OC-CORE-1032:
    title: '- [] Determinism MUST NOT be assumed across engine/model updates.'
    section: 4) Determinism
    level: must
    links:
    - .specs/10-orchestrator-core.md#4-determinism
  OC-CORE-1040:
    title: '- [] Logs MUST include job_id, session_id, engine, pool_id, replica_id, model_id, quant, ctx, kv_warmth, queue_time_ms, decode_time_ms.'
    section: 5) Observability
    level: must
    links:
    - .specs/10-orchestrator-core.md#5-observability
  OC-CORE-1041:
    title: '- [] Metrics MUST include queue depth, reject/drop counts, first-token/decode latency, GPU/VRAM utilization, KV pressure, preload outcomes.'
    section: 5) Observability
    level: must
    links:
    - .specs/10-orchestrator-core.md#5-observability
